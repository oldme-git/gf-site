<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-框架设计/工程开发设计/DAO封装设计/DAO-组件痛点及改进" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">DAO-组件痛点及改进 | GoFrame官网 - 类似PHP-Laravel和Java-SpringBoot的Go企业级开发框架</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://goframe.org/gf-site/docs/框架设计/工程开发设计/DAO封装设计/DAO-组件痛点及改进"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="DAO-组件痛点及改进 | GoFrame官网 - 类似PHP-Laravel和Java-SpringBoot的Go企业级开发框架"><meta data-rh="true" name="description" content="关于 DAO 数据访问对象设计其实是关于 GoFrame 框架工程化实践中比较重要一块设计。"><meta data-rh="true" property="og:description" content="关于 DAO 数据访问对象设计其实是关于 GoFrame 框架工程化实践中比较重要一块设计。"><link data-rh="true" rel="icon" href="/gf-site/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://goframe.org/gf-site/docs/框架设计/工程开发设计/DAO封装设计/DAO-组件痛点及改进"><link data-rh="true" rel="alternate" href="https://goframe.org/gf-site/docs/框架设计/工程开发设计/DAO封装设计/DAO-组件痛点及改进" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://goframe.org/gf-site/docs/框架设计/工程开发设计/DAO封装设计/DAO-组件痛点及改进" hreflang="x-default"><link rel="stylesheet" href="/gf-site/assets/css/styles.16d58885.css">
<script src="/gf-site/assets/js/runtime~main.60724009.js" defer="defer"></script>
<script src="/gf-site/assets/js/main.8ba10b8b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/gf-site/"><div class="navbar__logo"><img src="/gf-site/img/logo2.png" alt="GoFrame Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/gf-site/img/logo2.png" alt="GoFrame Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/gf-site/quick">快速开始</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">开发手册</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/gf-site/docs/框架设计">框架设计</a></li><li><a class="dropdown__link" href="/gf-site/docs/开发工具">开发工具</a></li><li><a class="dropdown__link" href="/gf-site/docs/核心组件">组件手册</a></li><li><a class="dropdown__link" href="/gf-site/docs/微服务开发">微服务开发</a></li><li><a class="dropdown__link" href="/gf-site/docs/WEB服务开发">WEB服务开发</a></li><li><a class="dropdown__link" href="/gf-site/docs/服务可观测性">服务可观测性</a></li></ul></div><a class="navbar__item navbar__link" href="/gf-site/release/v2.7">发布记录</a><a class="navbar__item navbar__link" href="/gf-site/communication">技术交流</a><a class="navbar__item navbar__link" href="/gf-site/supportus/index">支持我们</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/gf-site/docs/框架设计/工程开发设计/DAO封装设计/DAO-组件痛点及改进">Latest</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/gf-site/docs/框架设计/工程开发设计/DAO封装设计/DAO-组件痛点及改进">Latest</a></li><li><a class="dropdown__link" href="/gf-site/docs/2.7.x/框架设计/工程开发设计/DAO封装设计/DAO-组件痛点及改进">2.7.x</a></li></ul></div><a href="https://github.com/gogf/gf/issues" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">问题反馈<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/gogf/gf" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current,docs-quick-current,docs-release-current,docs-communication-current,docs-supportus-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/gf-site/docs">开发手册</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/gf-site/docs/框架设计">框架设计</a><button aria-label="折叠侧边栏分类 &#x27;框架设计&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gf-site/docs/框架设计/模块化设计">模块化设计</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gf-site/docs/框架设计/统一框架设计">统一框架设计</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/gf-site/docs/框架设计/工程开发设计">工程开发设计(🔥重点🔥)</a><button aria-label="折叠侧边栏分类 &#x27;工程开发设计(🔥重点🔥)&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/gf-site/docs/框架设计/工程开发设计/代码分层设计">代码分层设计</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/gf-site/docs/框架设计/工程开发设计/工程目录设计">工程目录设计🔥</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/gf-site/docs/框架设计/工程开发设计/DAO封装设计">DAO封装设计</a><button aria-label="折叠侧边栏分类 &#x27;DAO封装设计&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/gf-site/docs/框架设计/工程开发设计/DAO封装设计/DAO-组件痛点及改进">DAO-组件痛点及改进</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/gf-site/docs/框架设计/工程开发设计/DAO封装设计/DAO-工程痛点及改进">DAO-工程痛点及改进</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/gf-site/docs/框架设计/工程开发设计/结构化编程设计">结构化编程设计</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/gf-site/docs/框架设计/工程开发设计/数据模型与业务模型">数据模型与业务模型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/gf-site/docs/框架设计/工程开发设计/微服务大仓管理模式">微服务大仓管理模式</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/gf-site/docs/框架设计/微服务相关设计">微服务相关设计</a><button aria-label="展开侧边栏分类 &#x27;微服务相关设计&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gf-site/docs/框架设计/全链路跟踪设计">全链路跟踪设计</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gf-site/docs/框架设计/全错误堆栈设计">全错误堆栈设计</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gf-site/docs/框架设计/接口化与泛型设计">接口化与泛型设计</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gf-site/docs/框架设计/隐式与显式初始化">隐式与显式初始化</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/gf-site/docs/框架设计/Context相关设计">Context相关设计</a><button aria-label="展开侧边栏分类 &#x27;Context相关设计&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gf-site/docs/框架设计/Golang枚举值管理">Golang枚举值管理</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/gf-site/docs/开发工具">开发工具</a><button aria-label="展开侧边栏分类 &#x27;开发工具&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/gf-site/docs/核心组件">核心组件(🔥重点🔥)</a><button aria-label="展开侧边栏分类 &#x27;核心组件(🔥重点🔥)&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/gf-site/docs/组件列表">组件列表</a><button aria-label="展开侧边栏分类 &#x27;组件列表&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/gf-site/docs/微服务开发">微服务开发</a><button aria-label="展开侧边栏分类 &#x27;微服务开发&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/gf-site/docs/WEB服务开发">WEB服务开发</a><button aria-label="展开侧边栏分类 &#x27;WEB服务开发&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/gf-site/docs/网络服务开发">网络服务开发</a><button aria-label="展开侧边栏分类 &#x27;网络服务开发&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/gf-site/docs/服务可观测性">服务可观测性</a><button aria-label="展开侧边栏分类 &#x27;服务可观测性&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/gf-site/docs/项目部署/独立部署">项目部署</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/gf-site/docs/常见问题-FAQ">常见问题(FAQ)</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/gf-site/docs/install-go">其他资料</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/gf-site/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/gf-site/docs/框架设计"><span itemprop="name">框架设计</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/gf-site/docs/框架设计/工程开发设计"><span itemprop="name">工程开发设计(🔥重点🔥)</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/gf-site/docs/框架设计/工程开发设计/DAO封装设计"><span itemprop="name">DAO封装设计</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">DAO-组件痛点及改进</span><meta itemprop="position" content="4"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">版本：Latest</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>DAO-组件痛点及改进</h1></header><p>关于 <code>DAO</code> 数据访问对象设计其实是关于 <code>GoFrame</code> 框架工程化实践中比较重要一块设计。</p>
<p><code>DAO</code> 设计结合 <code>GoFrame</code> 的 <code>ORM</code> 组件性能和易用性都很强，可以极大提高开发和维护效率。看完本章节内容之后，小伙伴们应该能够理解并体会到使用 <code>DAO</code> 数据库访问对象设计的优点。</p>
<p>我每年都会来回重新审视这篇文章，看看是否可以删除一些地方。可是每次都倍感失望，因为这篇文章对当今现状仍旧适用。并且今年，我还新增了内容。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="一现有-orm-使用示例">一、现有 <code>ORM</code> 使用示例<a href="#一现有-orm-使用示例" class="hash-link" aria-label="一现有-orm-使用示例的直接链接" title="一现有-orm-使用示例的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1需要定义模型">1、需要定义模型<a href="#1需要定义模型" class="hash-link" aria-label="1、需要定义模型的直接链接" title="1、需要定义模型的直接链接">​</a></h3>
<p><img decoding="async" loading="lazy" src="/gf-site/assets/images/77daf5d299eabade856d950ab3161f94-b50361a3a6232ba6d81f0d79e67df4c5.png" width="1065" height="432" class="img_ev3q">用户基础表（仅作演示，真实的表有数十个字段）</p>
<p><img decoding="async" loading="lazy" src="/gf-site/assets/images/f4e8c70ee25ec329f2b64bb3a53ff503-1d32e08995f781aa0ffe379eba54a94d.png" width="1160" height="646" class="img_ev3q">医生信息表（仅作演示，真实的表有上百个字段）</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-grpc-接口实现示例">2、 <code>GRPC</code> 接口实现示例<a href="#2-grpc-接口实现示例" class="hash-link" aria-label="2-grpc-接口实现示例的直接链接" title="2-grpc-接口实现示例的直接链接">​</a></h3>
<p>一个简单的 <code>GRPC</code> 查询信息接口。</p>
<p><img decoding="async" loading="lazy" src="/gf-site/assets/images/b45b3af0a0bdc9ad30f739e31d0039ae-88e9e808d4ffdf213440b3e3bdc4770b.png" width="1154" height="894" class="img_ev3q">一个简单的 <code>GRPC</code> 数据查询接口</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="二现有痛点描述">二、现有痛点描述<a href="#二现有痛点描述" class="hash-link" aria-label="二、现有痛点描述的直接链接" title="二、现有痛点描述的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1必须要定义-tag-关联表结构与-struct-属性无法做到自动映射">1、必须要定义 <code>tag</code> 关联表结构与 <code>struct</code> 属性，无法做到自动映射<a href="#1必须要定义-tag-关联表结构与-struct-属性无法做到自动映射" class="hash-link" aria-label="1必须要定义-tag-关联表结构与-struct-属性无法做到自动映射的直接链接" title="1必须要定义-tag-关联表结构与-struct-属性无法做到自动映射的直接链接">​</a></h3>
<p>表字段与实体对象属性名称之间原本就有一定的关联规则，没有必要定义和维护大量的 <code>tag</code> 定义。</p>
<p><img decoding="async" loading="lazy" src="/gf-site/assets/images/f1bb2d203d4fe4f2c44bbc7e14b7832a-f3782e20453de0d57c8efeb5e5f2238a.png" width="769" height="644" class="img_ev3q"></p>
<p>大量非必要的 <code>tag</code> 定义，用于指定数据表字段到实体对象属性映射</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2不支持通过返回对象指定需要查询的字段">2、不支持通过返回对象指定需要查询的字段<a href="#2不支持通过返回对象指定需要查询的字段" class="hash-link" aria-label="2、不支持通过返回对象指定需要查询的字段的直接链接" title="2、不支持通过返回对象指定需要查询的字段的直接链接">​</a></h3>
<p>无法通过返回的对象数据结构指定查询字段，要么只能 <code>SELECT *</code> ，要么只能通过额外的方法手动录入查询字段，效率很低下。</p>
<p><img decoding="async" loading="lazy" src="/gf-site/assets/images/70e01c869632543b846b04a1696e9737-cd7d25aa20a2d730369db62469f90510.png" width="912" height="657" class="img_ev3q"></p>
<p>常见 的 <code>SELECT *</code> 操作，无法根据接口对象指定查询字段</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3无法对输入对象属性名称进行自动字段过滤">3、无法对输入对象属性名称进行自动字段过滤<a href="#3无法对输入对象属性名称进行自动字段过滤" class="hash-link" aria-label="3、无法对输入对象属性名称进行自动字段过滤的直接链接" title="3、无法对输入对象属性名称进行自动字段过滤的直接链接">​</a></h3>
<p>定义了输入与输出数据结构，输出的数据结构已经包含我们需要查询的字段名称。开发者输入定义的返回对象，期望在查询的时候仅查询我需要的字段名称，多余的属性则不会执行查询，自动过滤掉。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4需要创建中间查询结果对象执行赋值转换">4、需要创建中间查询结果对象执行赋值转换<a href="#4需要创建中间查询结果对象执行赋值转换" class="hash-link" aria-label="4、需要创建中间查询结果对象执行赋值转换的直接链接" title="4、需要创建中间查询结果对象执行赋值转换的直接链接">​</a></h3>
<p>查询结果不支持 <code>struct</code> 智能转换，需要额外定义一个中间 <code>model</code> 模型，再通过其他工具进行复制，效率低。</p>
<p><img decoding="async" loading="lazy" src="/gf-site/assets/images/05bf7722da09a27e7ca82bf6e0f89271-c1fa3d038052e85f8ac34728e8852f44.png" width="2252" height="1294" class="img_ev3q"></p>
<p>存在中间临时的模型对象，用于承接查询结果及返回结构对象赋值转换</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5需要提前初始化返回对象不管有无查询到数据">5、需要提前初始化返回对象，不管有无查询到数据<a href="#5需要提前初始化返回对象不管有无查询到数据" class="hash-link" aria-label="5、需要提前初始化返回对象，不管有无查询到数据的直接链接" title="5、需要提前初始化返回对象，不管有无查询到数据的直接链接">​</a></h3>
<p>这种方式不仅不优雅，对性能也有影响，还对 <code>GC</code> 不太友好。期望查询到数据时再自动创建返回对象，没有查询到数据时什么都不要做。</p>
<p><img decoding="async" loading="lazy" src="/gf-site/assets/images/239f4b75b4b77e85bca523371a7dd1b4-9c664ceb37f7b1fda957f96d5864811b.png" width="935" height="640" class="img_ev3q"></p>
<p>需要预先初始化返回对象，不管有无查询到数据</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6项目通篇使用底层裸-db-对象操作没有对象封装操作">6、项目通篇使用底层裸 <code>DB</code> 对象操作，没有对象封装操作<a href="#6项目通篇使用底层裸-db-对象操作没有对象封装操作" class="hash-link" aria-label="6项目通篇使用底层裸-db-对象操作没有对象封装操作的直接链接" title="6项目通篇使用底层裸-db-对象操作没有对象封装操作的直接链接">​</a></h3>
<p>大部分的 <code>Golang</code> 初学者似乎都倾向于使用一个全局的 <code>DB</code> 对象，在查询的时候通过 <code>DB</code> 对象生成特定表的 <code>Model</code> 对象再执行 <code>CURD</code> 操作，这是一种面向过程的使用方式。这种方式并没有代码分层的设计可言， <strong>使得数据操作和业务逻辑高度耦合</strong>。</p>
<p><img decoding="async" loading="lazy" src="/gf-site/assets/images/d73fdaa5b76b831db0a2c1069742c218-105f68f458e290a2d03dc0a450c4f6fe.png" width="1133" height="668" class="img_ev3q"></p>
<p>原始数据库对象操作方式，没有 <code>DAO</code> 封装</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="7随处可见的字符串硬编码如表名和字段的硬编码">7、随处可见的字符串硬编码，如表名和字段的硬编码<a href="#7随处可见的字符串硬编码如表名和字段的硬编码" class="hash-link" aria-label="7、 随处可见的字符串硬编码，如表名和字段的硬编码的直接链接" title="7、随处可见的字符串硬编码，如表名和字段的硬编码的直接链接">​</a></h3>
<p>举个例子， <code>userId</code> 这个字段假如一不小心写成了 <code>UserId</code> 或者 <code>userid</code>，测试的时候如果没有完全覆盖到，在一定的条件下才触发查询操作，是不是会造成新的一场事故呢？</p>
<p><img decoding="async" loading="lazy" src="/gf-site/assets/images/46d8aae38995327c6ce26832d21f628b-aab20cf6cfc3aeb8b4bd9d12e9e87b3d.png" width="2402" height="1304" class="img_ev3q"></p>
<p>大量的字符串硬编码</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="8底层orm引起太多的指针属性定义">8、底层ORM引起太多的指针属性定义<a href="#8底层orm引起太多的指针属性定义" class="hash-link" aria-label="8、底层ORM引起太多的指针属性定义的直接链接" title="8、底层ORM引起太多的指针属性定义的直接链接">​</a></h3>
<p>指针属性对象为业务逻辑处理埋下隐患，开发者在代码逻辑中需要在指针与属性之间来回切换，特别是一些基础类型往往需要通过重新取值的方式传递参数。如果输入参数是 <code>interface{}</code> 类型，那么更容易引起 <code>BUG</code>。</p>
<p><img decoding="async" loading="lazy" src="/gf-site/assets/images/620c8a9a4a47de0243748d588aa0bb51-7d237ccc764b58b03cb7d9c1e0e49d53.png" width="2464" height="1730" class="img_ev3q"></p>
<p><code>BUG</code> 示例，指针属性使用不当，引起地址比较逻辑错误。</p>
<p><img decoding="async" loading="lazy" src="/gf-site/assets/images/daa08ad1e9102f4ac964a8176a80e061-867ac37ef33fa994f2f6af27c3fcc2c7.png" width="2264" height="1716" class="img_ev3q"></p>
<p>同时也影响了业务模型结构体定义设计，对开发者造成了错误习惯引导（上层业务模型的指针属性往往是为了迎合底层数据表实体对象，方便数据传递）。</p>
<p><img decoding="async" loading="lazy" src="/gf-site/assets/images/bba716ea66e03727826ae6401ce01b2d-d3b19578993ec7e5f59cc5025a0e5fb1.png" width="2432" height="1730" class="img_ev3q"></p>
<p>值得注意一个常见错误，就是将底层数据实体模型当做顶层业务模型使用。特别是在底层数据实体对象使用指针属性的场景下，该问题十分明显。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="9可观测性的支持tracingmetricslogging">9、可观测性的支持：Tracing、Metrics、Logging<a href="#9可观测性的支持tracingmetricslogging" class="hash-link" aria-label="9、可观测性的支持：Tracing、Metrics、Logging的直接链接" title="9、可观测性的支持：Tracing、Metrics、Logging的直接链接">​</a></h3>
<p>数据库ORM作为业务项目最关键核心的组件，可观测性的支持至关重要。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="10数据集合与代码数据实体结构不一致">10、数据集合与代码数据实体结构不一致<a href="#10数据集合与代码数据实体结构不一致" class="hash-link" aria-label="10、数据集合与代码数据实体结构不一致的直接链接" title="10、数据集合与代码数据实体结构不一致的直接链接">​</a></h3>
<p>当通过人工维护数据实体结构时，数据集合与代码数据实体结构往往会出现不一致的风险，开发和维护成本高。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="三改进方案设计">三、改进方案设计<a href="#三改进方案设计" class="hash-link" aria-label="三、改进方案设计的直接链接" title="三、改进方案设计的直接链接">​</a></h2>
<p>1、查询结果对象无需特殊标签定义，全自动关联映射</p>
<p>2、支持根据指定对象自动识别查询字段，而不是全部 <code>SELECT *</code></p>
<p>3、支持根据指定对象自动过滤不存在的字段内容</p>
<p>4、使用 <code>DAO</code> 对象封装代码设计，通过对象方式操作数据表</p>
<p>5、 <code>DAO</code> 对象将关联的表名及字段名进行封装，避免字符串硬编码</p>
<p>6、无需提前定义实体对象接受返回结果，无需创建中间实体对象用于接口返回对象的赋值转换</p>
<p>7、查询结果对象无需提前初始化，查询到数据时才会自动创建</p>
<p>8、内置支持 <code>OpenTelemetry</code> 标准，实现可观测性，极大提高维护效率、降低成本</p>
<p>9、支持 <code>SQL</code> 日志输出能力，支持开关功能</p>
<p>10、数据模型、数据操作、业务逻辑解耦，支持 <code>Dao</code> 及 <code>Model</code> 代码工具化自动生成，保证数据集合与代码数据结构一致，提高开发效率，便于规范落地</p>
<p>11、等等。</p>
<p><img decoding="async" loading="lazy" src="/gf-site/assets/images/90537635dc3b5623060fa9edfc49948a-6e0517950a26ea1562c25067f1c811ec.png" width="2464" height="650" class="img_ev3q"></p>
<p>采用 <code>DAO</code> 设计改进后的代码示例</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/gogf/gf-site/blob/main/docs/1-框架设计/2-工程开发设计/2-DAO封装设计/0-DAO-组件痛点及改进.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">最后<!-- -->由 <b>John</b> <!-- -->于 <b><time datetime="2024-10-27T09:50:23.000Z" itemprop="dateModified">2024年10月27日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/gf-site/docs/框架设计/工程开发设计/DAO封装设计"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">DAO封装设计</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/gf-site/docs/框架设计/工程开发设计/DAO封装设计/DAO-工程痛点及改进"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">DAO-工程痛点及改进</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#一现有-orm-使用示例" class="table-of-contents__link toc-highlight">一、现有 <code>ORM</code> 使用示例</a><ul><li><a href="#1需要定义模型" class="table-of-contents__link toc-highlight">1、需要定义模型</a></li><li><a href="#2-grpc-接口实现示例" class="table-of-contents__link toc-highlight">2、 <code>GRPC</code> 接口实现示例</a></li></ul></li><li><a href="#二现有痛点描述" class="table-of-contents__link toc-highlight">二、现有痛点描述</a><ul><li><a href="#1必须要定义-tag-关联表结构与-struct-属性无法做到自动映射" class="table-of-contents__link toc-highlight">1、必须要定义 <code>tag</code> 关联表结构与 <code>struct</code> 属性，无法做到自动映射</a></li><li><a href="#2不支持通过返回对象指定需要查询的字段" class="table-of-contents__link toc-highlight">2、不支持通过返回对象指定需要查询的字段</a></li><li><a href="#3无法对输入对象属性名称进行自动字段过滤" class="table-of-contents__link toc-highlight">3、无法对输入对象属性名称进行自动字段过滤</a></li><li><a href="#4需要创建中间查询结果对象执行赋值转换" class="table-of-contents__link toc-highlight">4、需要创建中间查询结果对象执行赋值转换</a></li><li><a href="#5需要提前初始化返回对象不管有无查询到数据" class="table-of-contents__link toc-highlight">5、需要提前初始化返回对象，不管有无查询到数据</a></li><li><a href="#6项目通篇使用底层裸-db-对象操作没有对象封装操作" class="table-of-contents__link toc-highlight">6、项目通篇使用底层裸 <code>DB</code> 对象操作，没有对象封装操作</a></li><li><a href="#7随处可见的字符串硬编码如表名和字段的硬编码" class="table-of-contents__link toc-highlight">7、随处可见的字符串硬编码，如表名和字段的硬编码</a></li><li><a href="#8底层orm引起太多的指针属性定义" class="table-of-contents__link toc-highlight">8、底层ORM引起太多的指针属性定义</a></li><li><a href="#9可观测性的支持tracingmetricslogging" class="table-of-contents__link toc-highlight">9、可观测性的支持：Tracing、Metrics、Logging</a></li><li><a href="#10数据集合与代码数据实体结构不一致" class="table-of-contents__link toc-highlight">10、数据集合与代码数据实体结构不一致</a></li></ul></li><li><a href="#三改进方案设计" class="table-of-contents__link toc-highlight">三、改进方案设计</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ©2024 GoFrame OpenSource Team</div></div></div></footer></div>
</body>
</html>